# Week 5 - 2026-W05 (Jan 27 - Feb 2)

## Sunday, January 26, 2026

### Lint Error Fixes & Configuration Alignment

**Objective**: Systematically fix ESLint errors across the codebase and ensure consistent strict type checking across all tools.

#### Configuration Investigation
- ✅ Verified no changes to `tsconfig.json` from last commit
- ✅ Found only `eslint.config.ts` changed to use `tsconfig.lint.json` references
- ✅ Confirmed `line_results*.json` and `line-errors*.json` files don't exist (were temporary debug files)

#### TypeScript Config Consolidation
**Merged separate lint configs into main tsconfig files**:
- Merged `apps/desktop/tsconfig.lint.json` → `apps/desktop/tsconfig.json`
- Merged `apps/server/tsconfig.lint.json` → `apps/server/tsconfig.json`  
- Added `vitest.config.ts` to include arrays for all apps
- Fixed `apps/web/tsconfig.json` trailing comma syntax error
- Removed `rootDir` constraint from server tsconfig to allow vitest.config.ts
- Updated `eslint.config.ts` to reference main tsconfig files
- Deleted separate `tsconfig.lint.json` files

**Rationale**: Simplified configuration by having one source of truth per app instead of separate lint configs.

#### Lint Error Fixes (Apps Folder)

**Config Files** (`apps/server/src/config/`) - **9 files fixed**:
- `auth/jwt.ts` - Replaced `||` with `??`, fixed nullable string checks
- `auth/rate-limit.ts` - Fixed nullable string conditionals
- `services/billing.ts` - Fixed all nullish coalescing and nullable strings
- `services/email.ts` - Fixed nullable string conditionals  
- `services/notifications.ts` - Fixed availability checks and nullish coalescing
- `services/search.ts` - Fixed nullable string conditionals
- `infra/storage.ts` - Fixed nullish coalescing
- `infra/cache.ts` - Fixed nullish coalescing
- `infra/server.ts` - Fixed nullable string conditionals in URL resolution

**Infrastructure Files** (`apps/server/src/infrastructure/`) - **Started**:
- `billing/stripe-provider.ts` - Fixed nullish coalescing (`??` instead of `||`)
- `billing/index.ts` - Changed to `export type *` for type-only exports

**Common Patterns Fixed**:
1. `@typescript-eslint/strict-boolean-expressions` - Nullable string conditionals
2. `@typescript-eslint/prefer-nullish-coalescing` - Using `??` instead of `||`
3. `@typescript-eslint/consistent-type-exports` - Type-only exports

#### Configuration Alignment

**Analyzed ESLint vs TypeScript strictness**:
- Both use strict type checking ✅
- ESLint has `allowString: true` for `strict-boolean-expressions` (pragmatic approach)
- TypeScript already has all strict compiler options enabled
- **Decision**: Keep ESLint's standard, align other tools to match

**VSCode Settings** (`.vscode/settings.json`):
- Added TypeScript strict preferences:
  - `typescript.preferences.strictNullChecks: true`
  - `typescript.preferences.noImplicitAny: true`
  - `typescript.preferences.strictFunctionTypes: true`
- Added `problems.showCurrentInStatus` for better error visibility
- Added `editor.formatOnSave` for auto-formatting
- Added file watcher exclusions for `.turbo`, `dist`, `build`, `.cache`
- Added search exclusions for build artifacts

**Result**: ESLint, TypeScript, and VSCode now enforce the same strict rules consistently!

#### Progress Metrics
- **Starting errors**: ~3,431 total
- **Current errors**: ~3,395 total  
- **Apps folder**: Reduced from ~3,400 files with errors to ~180 files
- **Config folder**: Mostly complete (9/13 files fixed)
- **Infrastructure folder**: Started (2 files fixed)

#### Remaining Work
- ~180 files remaining in apps folder (infrastructure, modules, tests)
- ~3,200+ errors in packages folder (not started)
- Desktop electron test file parsing errors
- Minor test file and console statement issues

#### Technical Decisions

**Why `??` instead of `||`?**
- `||` treats `0`, `false`, `""` as falsy (can cause bugs)
- `??` only treats `null` and `undefined` as nullish (safer)
- Example bug prevented:
  ```typescript
  const port = env.PORT || 8080; // Bug: PORT=0 becomes 8080
  const port = env.PORT ?? 8080; // Correct: PORT=0 stays 0
  ```

**Why explicit null checks?**
- ESLint's `strict-boolean-expressions` with `allowString: true` allows `if (str)`
- But `if (str)` fails on empty string `""`
- Explicit checks: `if (str != null && str !== '')` catch both null and empty
- Trade-off: More verbose but prevents empty string bugs

**Desktop App Architecture**:
- Keeping two separate tsconfigs: one for React renderer, one for Electron main process
- Allows desktop-specific features while sharing code with web app
- Maintains flexibility for future desktop-specific UI

---

## Next Steps
1. Continue fixing remaining ~180 files in apps folder
2. Move to packages folder (~3,200+ errors)
3. Run full lint check and verify all fixes
