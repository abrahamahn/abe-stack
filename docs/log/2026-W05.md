# Week 5 - 2026-W05 (Jan 27 - Feb 2)

## Sunday, January 26, 2026

### Lint Error Fixes & Configuration Alignment

**Objective**: Systematically fix ESLint errors across the codebase and ensure consistent strict type checking across all tools.

#### Configuration Investigation
- ✅ Verified no changes to `tsconfig.json` from last commit
- ✅ Found only `eslint.config.ts` changed to use `tsconfig.lint.json` references
- ✅ Confirmed `line_results*.json` and `line-errors*.json` files don't exist (were temporary debug files)

#### TypeScript Config Consolidation
**Merged separate lint configs into main tsconfig files**:
- Merged `apps/desktop/tsconfig.lint.json` → `apps/desktop/tsconfig.json`
- Merged `apps/server/tsconfig.lint.json` → `apps/server/tsconfig.json`  
- Added `vitest.config.ts` to include arrays for all apps
- Fixed `apps/web/tsconfig.json` trailing comma syntax error
- Removed `rootDir` constraint from server tsconfig to allow vitest.config.ts
- Updated `eslint.config.ts` to reference main tsconfig files
- Deleted separate `tsconfig.lint.json` files

**Rationale**: Simplified configuration by having one source of truth per app instead of separate lint configs.

#### Lint Error Fixes (Apps Folder)

**Config Files** (`apps/server/src/config/`) - **9 files fixed**:
- `auth/jwt.ts` - Replaced `||` with `??`, fixed nullable string checks
- `auth/rate-limit.ts` - Fixed nullable string conditionals
- `services/billing.ts` - Fixed all nullish coalescing and nullable strings
- `services/email.ts` - Fixed nullable string conditionals  
- `services/notifications.ts` - Fixed availability checks and nullish coalescing
- `services/search.ts` - Fixed nullable string conditionals
- `infra/storage.ts` - Fixed nullish coalescing
- `infra/cache.ts` - Fixed nullish coalescing
- `infra/server.ts` - Fixed nullable string conditionals in URL resolution

**Infrastructure Files** (`apps/server/src/infrastructure/`) - **Started**:
- `billing/stripe-provider.ts` - Fixed nullish coalescing (`??` instead of `||`)
- `billing/index.ts` - Changed to `export type *` for type-only exports

**Common Patterns Fixed**:
1. `@typescript-eslint/strict-boolean-expressions` - Nullable string conditionals
2. `@typescript-eslint/prefer-nullish-coalescing` - Using `??` instead of `||`
3. `@typescript-eslint/consistent-type-exports` - Type-only exports

#### Configuration Alignment

**Analyzed ESLint vs TypeScript strictness**:
- Both use strict type checking ✅
- ESLint has `allowString: true` for `strict-boolean-expressions` (pragmatic approach)
- TypeScript already has all strict compiler options enabled
- **Decision**: Keep ESLint's standard, align other tools to match

**VSCode Settings** (`.vscode/settings.json`):
- Added TypeScript strict preferences:
  - `typescript.preferences.strictNullChecks: true`
  - `typescript.preferences.noImplicitAny: true`
  - `typescript.preferences.strictFunctionTypes: true`
- Added `problems.showCurrentInStatus` for better error visibility
- Added `editor.formatOnSave` for auto-formatting
- Added file watcher exclusions for `.turbo`, `dist`, `build`, `.cache`
- Added search exclusions for build artifacts

**Result**: ESLint, TypeScript, and VSCode now enforce the same strict rules consistently!

#### Progress Metrics
- **Starting errors**: ~3,431 total
- **Current errors**: ~3,395 total  
- **Apps folder**: Reduced from ~3,400 files with errors to ~180 files
- **Config folder**: Mostly complete (9/13 files fixed)
- **Infrastructure folder**: Started (2 files fixed)

#### Remaining Work
- ~180 files remaining in apps folder (infrastructure, modules, tests)
- ~3,200+ errors in packages folder (not started)
- Desktop electron test file parsing errors
- Minor test file and console statement issues

#### Technical Decisions

**Why `??` instead of `||`?**
- `||` treats `0`, `false`, `""` as falsy (can cause bugs)
- `??` only treats `null` and `undefined` as nullish (safer)
- Example bug prevented:
  ```typescript
  const port = env.PORT || 8080; // Bug: PORT=0 becomes 8080
  const port = env.PORT ?? 8080; // Correct: PORT=0 stays 0
  ```

**Why explicit null checks?**
- ESLint's `strict-boolean-expressions` with `allowString: true` allows `if (str)`
- But `if (str)` fails on empty string `""`
- Explicit checks: `if (str != null && str !== '')` catch both null and empty
- Trade-off: More verbose but prevents empty string bugs

**Desktop App Architecture**:
- Keeping two separate tsconfigs: one for React renderer, one for Electron main process
- Allows desktop-specific features while sharing code with web app
- Maintains flexibility for future desktop-specific UI

---

### Tuesday, January 27, 2026

### "Golden Standard" Configuration & Scaling

**Objective**: Reach absolute maximum strictness in TypeScript/ESLint and ensure the monorepo scales by resolving OOM issues.

#### Absolute Strictness Implementation
- **TypeScript 5.7+ Upgrade**: Enabled `exactOptionalPropertyTypes` and `noPropertyAccessFromIndexSignature`.
- **ESLint Golden Standard**:
    - Added `@typescript-eslint/naming-convention` (strict PascalCase for types, camelCase for logic).
    - Enabled `import-x/no-cycle` for cyclic dependency detection.
    - Added `unused-imports/no-unused-imports` for automatic cleanup.
    - Enabled `@typescript-eslint/no-deprecated` to prevent stall API usage.

#### Performance & Scaling (OOM Resolution)
- **Turbo-Powered Parallel Linting**: Migrated root-level linting from a single massive orchestrator to `turbo run lint`.
    - Resolved "JavaScript heap out of memory" (OOM) by isolating each package's type-checker.
    - Enabled `--continue` to ensure full transparency of all 1100+ errors across the project.
- **Centralized Performance Cache**: Moved all package `.eslintcache` files to `node_modules/.cache/eslint/` to keep package folders clean while maintaining speed.
- **Turbo Type-Check**: Migrated `tsc --build` to `turbo run type-check` for better parallelization and caching.

#### Monorepo Hygiene & Transparency
- **Moved `.editorconfig` to `.config/`**: Maintained "Clean Root" philosophy while ensuring IDE consistency via centralized hub.
- **Centralized Docs**: Updated `.config/README.md` with a "Strictness by Default" philosophy and a guide for users on how to step down/loosen rules.
- **Consolidated pnpm settings**: Moved workspace-level pnpm settings to `package.json` and eliminated `.npmrc`/`.pnpmrc` to declutter the root.

**Result**: The monorepo now follows "Big Tech" industry standards for type safety, performance, and documentation clarity.

#### Remaining Work
- Address the ~1100+ surfaced errors (Naming conventions, Strict Booleans, etc.)
- Systematic extension fix (`.js` imports for ESM)
- Fix strict null/undefined checks identified by new strictness levels.

---

## Next Steps
1. Systematically fix extensions and surfaced lint errors across packages.
2. Finalize verification of the new parallel build pipeline.
