# Week 7: February 9-15, 2026

> **Summary**: CI/CD hardening for GitHub Actions and DigitalOcean deployment flow. Stabilized pre-commit/pre-push checks, fixed monorepo test/lint breakages, and cleaned workflow reliability issues.

---

## Tuesday, February 10, 2026

### CI/CD and Workflow Stabilization

- Consolidated workflow structure and naming (`deploy` workflow cleanup and infra deploy alignment).
- Fixed broken infra-test conditions caused by invalid matrix/secrets usage at job-level `if`.
- Removed invalid `snyk/actions@v4` reference (tag does not exist).
- Addressed CodeQL workflow warnings (version/language matrix cleanup plan identified).
- Confirmed artifact dependency behavior for infrastructure metadata retrieval.

### Pre-commit / Pre-push Pipeline Improvements

- Enforced header-sync check in push flow and aligned commit-time expectations.
- Kept no-Husky setup and removed extra hook folders from project root (`.husky`, `.githooks`) in favor of leaner structure.
- Diagnosed and resolved `sync:headers:check` command path/availability issues in CI.

### Test and Lint Recovery

- Fixed type-aware lint explosion in realtime package by restoring inherited TS path resolution (removed local `"paths": {}` overrides where they shadowed monorepo aliases).
- Added/updated Vitest alias mappings across packages (`server/engine`, `server/websocket`, `client/react`, `client/ui`) to resolve workspace package entry failures.
- Stabilized desktop tests with flaky timing/call-count assumptions.
- Updated websocket test mocks to avoid pulling heavy transitive runtime deps during unit tests.
- Resolved DB lint ordering failure in `src/server/db/src/queue/write-service.ts`.
- Final verification runs completed successfully for:
  - package-level realtime/websocket/ui/react/desktop suites
  - full root `pnpm test`
  - full root `pnpm lint`

### Commits (Today)

- `4edfd84c` update commit
- `66e1ecd7` update
- `07fc7f54` update github actions
- `a7d7b3b0` update
- `59692071` update fixes
- `80188eb2` update commit
- `6ee38959` fix(infra-test): remove invalid matrix reference from job-level if
- `0eec8827` update dependency
- `2d074e78` update commit
- `f0cebdf5` update infra workflow
- `961c44ce` update infra workflow
- `969de62d` test infra workflow
- `dc7ed931` test infra workflow
- `df23c73b` test infra workflow
- `95532f56` test infra workflow
- `31a66087` test infra workflow
- `7325c411` test infra workflow
- `1af86865` update cache

### Late-Day CI Parity and Sanity-Check Stabilization

- Fixed repeated local-vs-CI discrepancy where type-aware ESLint reported unresolved `error` types in CI while local appeared green.
- Root cause pattern confirmed:
  - package/app tsconfig `paths` overrides shadowing monorepo alias inheritance,
  - type-aware lint execution before package dist artifacts exist in CI,
  - stale/generated local artifacts masking issues.
- Added explicit workspace source alias mappings in client-side packages to stabilize resolver behavior during CI lint:
  - `src/client/engine/tsconfig.json`
  - `src/client/ui/tsconfig.json`
  - `src/client/react/tsconfig.json`
- Reverted unsafe server-side alias overrides that pulled external source files into package `tsc` programs and caused project-boundary type-check failures.
- Fixed persistent DB lint blocker in:
  - `src/server/db/src/queue/write-service.ts` (strict `import-x/order` grouping/alphabetization)
- Removed untracked generated JS artifacts under `src/server/db/src/**/*.js` and `*.js.map` that caused local-only lint noise and parity drift.
- Hardened workflow formatting enforcement path:
  - kept pre-commit YAML formatting coverage (`*.yml`, `*.yaml`),
  - made CI format check uncached via `pnpm format:check:ci` (`--no-cache`),
  - repaired YAML block indentation regressions in `.github/workflows/infra-test.yml`.
- Reduced flaky security timing test failures by widening CI-tolerant assertion window in:
  - `src/server/core/src/auth/__tests__/login-edge-cases.test.ts`

### Verification Snapshot (End of Session)

- `pnpm lint` passed.
- `pnpm type-check` passed.
- `pnpm test` passed.
- Targeted package lint/type checks for previously failing sets (`client-engine`, `ui`, `react`, `server-engine`, `media`, `db`) passed after fixes.
