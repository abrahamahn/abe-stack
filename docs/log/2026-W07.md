# Week 7: February 9–15, 2026

> **Summary**: CI and developer workflow hardening week focused on reliability and cache correctness.
>
> - GitHub Actions stabilization across `ci`, `infra-test`, and `security` workflows
> - Terraform infrastructure test flow refined for provider-specific execution and clearer failure handling
> - Local/CI consistency fixes for TypeScript + ESLint type-resolution issues caused by tsconfig alias overrides
> - Cache strategy consolidated under `node_modules/.cache` with stronger invalidation on config changes
> - Hook policy simplified: fast pre-commit, full validation on pre-push/CI

---

## Tuesday, February 10, 2026

### CI and Workflow Stabilization

- Restored/standardized `sync:headers:check` usage in CI verification flow.
- Fixed invalid GitHub Actions expression in `.github/workflows/infra-test.yml` (matrix reference in job-level `if`).
- Iterated on infrastructure testing workflow behavior:
  - improved matrix/provider gating behavior,
  - improved failure diagnostics and summary output,
  - aligned execution with active provider strategy.
- Updated security workflow behavior and scan defaults to reduce noisy failures during normal pushes while preserving scheduled/manual scan coverage.

### Terraform and Cloud Provider Guardrails

- Investigated repeated `infra/cloud/gcp/main.tf` formatting failures (`terraform fmt -recursive`) in infra tests.
- Clarified that multi-provider infra checks can fail even when actively deploying to DigitalOcean, unless provider scope is explicitly constrained.
- Added provider-selection controls in workflow logic so infra checks can be disabled/scoped per active cloud provider.

### Local vs CI Consistency Fixes

- Reproduced CI lint failures locally with no-cache execution to confirm the issue was not cache-only.
- Fixed TypeScript path alias resolution regressions by removing/repairing `paths` overrides that shadowed inherited monorepo aliases:
  - `src/server/realtime/tsconfig.json`
  - `src/client/engine/tsconfig.json`
  - `src/client/api/tsconfig.json`
- Result: ESLint “error typed / unsafe member access” cascades were reduced by restoring correct type resolution.

### Cache and Hook Strategy Improvements

- Consolidated cache outputs to `node_modules/.cache` (Turbo already uses `node_modules/.cache/turbo`).
- Updated local cache maintenance state file to live under `node_modules/.cache`.
- Strengthened Turbo cache invalidation for config changes by expanding `globalDependencies` in `turbo.json` to include:
  - Vitest configs (`vitest.config.ts`, `vitest.workspace.ts`, `**/vitest.config.ts`)
  - tsconfig variants (`**/tsconfig*.json`)
  - ESLint config variants (`**/eslint.config.{ts,js,mjs,cjs}`, `config/tsconfig.eslint.json`)
  - broader config tree pattern (`config/**/*.{ts,js,mjs,cjs,json}`)
- Hook execution policy refined:
  - pre-commit remains staged and fast,
  - full lint/type-check/test gate remains in pre-push and CI.

### Ops Notes Captured

- DigitalOcean token setup guidance documented during triage:
  - prefer scoped access where possible,
  - use full access only when workflow requires broad create/update/delete API coverage.
- Deployment secret/variable mapping walkthrough completed for domain, host, SSH, registry, and provider credentials.

### In-Progress (Local, Not Yet Committed)

- `infra/git-hooks/pre-commit`: removed cache-maintenance step to keep commits fast.
- `src/server/db/src/queue/write-service.ts`: local modification pending commit review.
