# Configuration

## TypeScript Configuration

### Hierarchy

The root `tsconfig.json` defines shared compiler options and project references. Each package extends it via `"references"` in the root config.

```
tsconfig.json (root)
├── src/apps/web/tsconfig.json
├── src/apps/server/tsconfig.json
├── src/apps/desktop/tsconfig.json
├── src/shared/tsconfig.json
├── src/server/core/tsconfig.json
├── src/server/db/tsconfig.json
├── src/server/engine/tsconfig.json
├── src/client/ui/tsconfig.json
├── src/client/api/tsconfig.json
└── src/client/react/tsconfig.json
```

### Key Compiler Options

The root config enforces strict TypeScript:

```jsonc
{
  "target": "ES2023",
  "module": "ESNext",
  "moduleResolution": "bundler",
  "strict": true,
  "noUncheckedIndexedAccess": true, // Index signatures return T | undefined
  "noImplicitOverride": true,
  "exactOptionalPropertyTypes": true, // Distinguish undefined from missing
  "verbatimModuleSyntax": true, // Enforces explicit type imports
  "composite": true, // Required for project references
  "incremental": true, // Build caching
}
```

Build cache is stored at `node_modules/.cache/typescript/tsconfig.tsbuildinfo`.

### Package Aliases

Defined in the root `tsconfig.json` `compilerOptions.paths`:

| Alias                      | Source                             |
| -------------------------- | ---------------------------------- |
| `@abe-stack/shared`        | `./src/shared/src/index.ts`        |
| `@abe-stack/ui`            | `./src/client/ui/src/index.ts`     |
| `@abe-stack/api`           | `./src/client/api/src/index.ts`    |
| `@abe-stack/core`          | `./src/server/core/src/index.ts`   |
| `@abe-stack/db`            | `./src/server/db/src/index.ts`     |
| `@abe-stack/server-engine` | `./src/server/engine/src/index.ts` |

Subpath aliases (e.g., `@abe-stack/shared/*`) map to the corresponding source directories.

## Path Aliases (Web App)

Web app path aliases are defined in both `tsconfig.json` and `vite.config.ts`. They are auto-generated by the `sync-path-aliases` dev automation (see `docs/dev/sync-scripts.md`).

Common aliases in `src/apps/web/`:

| Alias        | Path                       |
| ------------ | -------------------------- |
| `@`          | `./src/*`                  |
| `@app`       | `./src/app`                |
| `@auth`      | `./src/features/auth`      |
| `@features`  | `./src/features`           |
| `@config`    | `./src/config`             |
| `@dashboard` | `./src/features/dashboard` |
| `@settings`  | `./src/features/settings`  |
| `@billing`   | `./src/features/billing`   |

New aliases are auto-created when you add a directory with an `index.ts` barrel file.

## Vite Configuration

The web app's Vite config is at `src/apps/web/vite.config.ts`.

### Dev Server

```typescript
server: {
  port: 5173,
  strictPort: true,
  open: true,
  proxy: {
    '/api':     { target: 'http://localhost:8080', changeOrigin: true },
    '/ws':      { target: 'ws://localhost:8080', ws: true },
    '/uploads': { target: 'http://localhost:8080', changeOrigin: true },
  },
}
```

The proxy forwards API requests from the Vite dev server to the Fastify backend on port 8080.

### Build Output

```typescript
build: {
  outDir: 'dist',
  rollupOptions: {
    output: {
      manualChunks: {
        'vendor-react': ['react', 'react-dom'],  // Separate React vendor chunk
      },
    },
  },
  chunkSizeWarningLimit: 300,   // Warn on chunks > 300KB
  cssCodeSplit: true,           // Split CSS per route
  minify: 'esbuild',
  target: 'es2020',
}
```

### Resolve Aliases

Vite resolves monorepo packages to source files (not dist) via the `resolve.alias` config. This enables HMR across packages during development. The `conditions: ['source']` setting ensures Vite prefers source entry points.

## Environment Variables

Environment variables are validated at startup using Zod schemas defined in `src/shared/src/config/`. The validated config object is used throughout the application.

```typescript
// Example: accessing validated config
import { config } from '@abe-stack/shared/config';

config.server.port; // number, validated
config.auth.jwtSecret; // string, validated length >= 32
config.db.connectionString; // string, validated format
```

Environment files are stored in `config/env/`:

| File               | Purpose                           |
| ------------------ | --------------------------------- |
| `.env.local`       | Local development (not committed) |
| `.env.development` | Development defaults              |
| `.env.production`  | Production defaults               |

## Turbo Configuration

Turbo (`turbo.json`) orchestrates monorepo tasks with caching:

- `build`, `lint`, `type-check`, `test` are turbo-managed tasks
- Output is cached at `node_modules/.cache/turbo/`
- `--output-logs=errors-only` keeps CI output clean
- Turbo respects package dependency graph for build order

```bash
# View turbo task graph
pnpm exec turbo run build --graph
```
